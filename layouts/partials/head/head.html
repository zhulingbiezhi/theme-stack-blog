<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>

{{- $description := partialCached "data/description" . .RelPermalink -}}
<meta name='description' content='{{ $description }}'>

{{- $title := partialCached "data/title" . .RelPermalink -}}
<title>{{ $title }}</title>

{{- $keywordsArray := slice -}} <!-- 初始化为空切片 -->
{{- with partialCached "data/keywords" . .RelPermalink -}}
    {{- $keywordsArray = split . "," -}} <!-- 将字符串转换为切片 -->
{{- end -}}

{{- $categoriesArray := slice -}} <!-- 初始化为空切片 -->
{{- with partialCached "data/categories" . .RelPermalink -}}
    {{- $categoriesArray = split . "," -}} <!-- 将字符串转换为切片 -->
{{- end -}}

{{- if and $keywordsArray $categoriesArray }}
    {{- $mergedArray := append $keywordsArray $categoriesArray }}   <!-- 合并两个切片 -->
    {{- $uniqueArray := uniq $mergedArray }}   <!-- 去重 -->
    {{- $keywordsString := delimit $uniqueArray "," }}  <!-- 使用 delimit 拼接成字符串 -->
    <meta name='keywords' content='{{ $keywordsString }}'>
{{- end -}}


<link rel='canonical' href='{{ .Permalink }}'>

{{- if hugo.IsMultilingual -}}
    {{- range .Translations -}}
        <link rel="alternate" hreflang="{{ .Language.Lang }}" href="{{ .Permalink }}" />
    {{- end -}}
    <link rel="alternate" hreflang="{{ .Language.Lang }}" href="{{ .Permalink }}" />
    <link rel="alternate" hreflang="x-default" href="{{ .Permalink }}" />
{{- end -}}

<!-- DNS 预解析和预连接 -->
<link rel="dns-prefetch" href="https://busuanzi.ibruce.info">
<link rel="dns-prefetch" href="https://us.umami.is">
<link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">
<link rel="dns-prefetch" href="https://www.googletagmanager.com">
<link rel="dns-prefetch" href="https://comment.ququ123.top">
<link rel="dns-prefetch" href="https://unpkg.com">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
<link rel="preconnect" href="https://comment.ququ123.top" crossorigin>
<link rel="preconnect" href="https://unpkg.com" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

<!-- 无闪烁方案：使用 font-display: optional + 激进预加载 + 字体加载检测 -->
<!-- 1. DNS 预解析和预连接（最高优先级） -->
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

<!-- 2. 预加载字体文件（最高优先级，在HTML解析时就开始下载） -->
<link rel="preload" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/files/lxgwwenkaiscreen-regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- 3. 内联 @font-face 定义，使用 optional 策略（100ms窗口期，避免闪烁） -->
<style>
@font-face {
    font-family: 'LXGW WenKai Screen';
    src: url('https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/files/lxgwwenkaiscreen-regular.woff2') format('woff2');
    font-weight: 400;
    font-style: normal;
    font-display: optional; /* 100ms窗口期，如果加载完成就使用，否则永远使用备用字体，完全避免闪烁 */
}

/* 字体加载检测：在字体加载完成前短暂隐藏文本，避免闪烁 */
/* 应用到所有页面：首页、列表页、文章页、归档页、搜索页等 */
html.fonts-loading .main-container,
html.fonts-loading footer {
    opacity: 0;
    transition: opacity 0.1s ease-in;
}

/* 字体加载完成后显示内容 */
html.fonts-loaded .main-container,
html.fonts-loaded footer,
html.fonts-fallback .main-container,
html.fonts-fallback footer {
    opacity: 1;
    transition: opacity 0.1s ease-in;
}
</style>

<!-- 4. 异步加载完整字体CSS（不阻塞渲染） -->
<link rel="preload" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css"></noscript>

{{- partial "head/style.html" . -}}
{{- partial "head/script.html" . -}}
{{- partial "head/opengraph/include.html" . -}}

{{- range .AlternativeOutputFormats -}}
    <link rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink | safeURL }}">
{{- end -}}

{{ if .Params.math }}{{- partial "helper/katex.html" . -}}{{ end }}
{{ if .Params.mermaid }}{{- partial "helper/mermaid.html" . -}}{{ end }}

{{ with .Site.Params.favicon }}
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="shortcut icon" href="/favicon.ico" />
{{ else }}
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="shortcut icon" href="/favicon.ico" />
{{ end }}

{{- template "_internal/google_analytics.html" . -}}
{{- partial "head/custom.html" . -}}

<meta http-equiv="Content-Type" content="text/html;charset=gb2312" />
<meta name="sogou_site_verification" content="OTPHpNvnjL" />
<meta name="bytedance-verification-code" content="rr0mrnQIsV99xSttyBKD" />
<meta name="360-site-verification" content="5b3e2696c1e86dcab859bafe70fc6062" />
<meta name="yandex-verification" content="247bcf40438ae313" />
<!-- Google tag (gtag.js) with GDPR compliance -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MY9LX4PFXY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  // Set default consent state - will be updated by cookie consent
  gtag('consent', 'default', {
    'analytics_storage': 'denied',
    'ad_storage': 'denied',
    'ad_user_data': 'denied',
    'ad_personalization': 'denied'
  });

  gtag('config', 'G-MY9LX4PFXY', {
    'anonymize_ip': true,
    'cookie_flags': 'SameSite=None;Secure'
  });
</script>